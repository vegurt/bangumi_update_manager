# 简介
一款基于RSS订阅的交互命令行式番剧更新管理器，让你摆脱追番烦恼

# Quick Start

## 准备

安装 Python3.11，运行以下命令：

```cmd
pip install -i https://mirror.baidu.com/pypi/simple/ pyperclip requests lxml rich
```

## 第一步：添加番剧

```cmd
add bangumi_name
```

输入上面的命令，然后就会让你设置搜索关键词和过滤器

关键词：非必填项，每个关键词之间用空格分隔

过滤器：必填项，使用正则表达式过滤，使用 `re.Match.group(1)` 识别集数（懂了伐？集数用括号括起来，最多只能用一对括号（大神不用管），标题里的括号用反斜杠转义，非要用括号就用 `(?:regex)` 格式），一次一个，会让你输入多条规则。集数不是必须的，有一条正则表达式匹配就会收录。不懂的，或者觉得不需要过滤，关键词就能够分毫不差地把需要的东西找出来，不多也不少，就输入 `.*`，搜到了就收录，不过滤，网上正则表达式教程多得很，又不难。

起始序号：有的字幕组或压制组在做第二季内容时序号不会重新从 1 开始算，而是从第一季末尾开始，比如第一季有 12 集，那第二季就从 13 开始，他的起始序号就是 13，但我们从 1 开始。这里默认就是 1，不是其他的直接摁回车。配合过滤器识别剧集集数用的，防止一集收了两次。

*必填项不是说你不填就不加了，而是这个没有那更新的时候就跳过不管了。也就是说，要让它更新，番剧名和过滤器一样都不能少。*

**示例：**

> 番剧名：憧憬成为魔法少女
> 
> 关键词：憧憬成为魔法少女 1080
>
> 过滤器1
> 正则表达式：`LoliHouse.*?- (\d+).*?简`
> 起始序号：`1`
>
> 过滤器2
> 正则表达式：`喵萌奶茶屋.*?\[(\d+)\].*?简`
> 起始序号：`1`
>
> 过滤器3
> 正则表达式：`桜都字幕组.*?\[(\d+)\].*?简`
> 起始序号：`1`
>
> 过滤器4
> 正则表达式：`Billion.*?\[(\d+)\].*?简`
> 起始序号：`1`
>
> 过滤器5
> 正则表达式：`悠哈.*?\[(\d+)\].*?CHS`
> 起始序号：`1`

## 第二步：更新&下载

直接输这个然后摁回车：

```cmd
f
```

怎么样？简单吧？更新+下载+保存一条龙服务！

这里下载的种子会保存在 torrents 文件夹里面，自己去找bt下载器吧，这就不是我的事了

完了会自动保存番剧数据文件，当然第一次会让你设置文件名，保存在相同路径下.xml文件。

## 第三步：保存&退出

虽然在第二步的一条龙服务中已经保存过了，但依然建议在退出之前手动保存一下。谁知道你会不会忘记你还运行了其它的会改变内容的指令呢？

如果只是保存一下，之后还要做其他事情，则输入以下指令。

```cmd
save
```

若还没有指定文件名，会让你设置的

如果要退出，则输入以下指令。

```cmd
exit
```

这个指令会先保存文件再退出。因此，不要直接点终端上的叉号直接关闭程序，不然辛辛苦苦输进去的番剧就又要重来一遍了哟。

## 第二次启动

第二次启动直接把上次保存的数据文件，就你输入的文件名的.xml文件，拖到脚本文件上面。哦，记得在系统里把.py文件的默认打开方式设置为 Python，而不是 pycharm 或什么其他的东西，不然你就自己进命令行打开吧。

最后按 f 更新，齐活

# 常用指令

项目有3个层级，从高到低依次是：主页，番剧，剧集

## 选择 `select` | `open`

**用法：**

```cmd
select idx1 [idx2]
open idx1 [idx2]
```

**适用范围：主页，番剧，剧集**

在主页和剧集，两者作用一致

在番剧中：
`select` 选择与当前层级相同的序号为 idx 的项目
`open` 则进入当前选择项目的序号为 idx 的子项目

## 返回 `back`

**用法：**

```cmd
back
```

**适用范围：番剧，剧集**

返回上级

## 主页 `home`

**用法：**

```cmd
home
```

**适用范围：主页，番剧，剧集**

回到主页

## 展示 `show` | `list`

**用法：**

```cmd
show idx
list idx
```

**适用范围：主页，番剧，剧集**

show 是展示当前选择的项目，list 是展示所包含的子项目

show 不可在主页中使用，而 list 不可在剧集中使用

可使用参数，预选择序号为idx的子内容

## 添加项目 `add`


在主页中为添加番剧，在番剧中为添加过滤器

## 标记 `mark`

**用法：**

```cmd
mark updating|end|abandoned|pause
mark old|new
```

**适用范围：主页，番剧，剧集**

参数为 `updating`|`end`|`abandoned`|`pause` 时，只在番剧中有用，将番剧标记为：更新中|已完结|已放弃追番|暂停更新以后再看

参数为 `old`|`new` 时，全局可用，将项目标记为：已观看的旧项目|刚出锅的新项目

## 保存 `save`

**用法：**

```cmd
save
```

**适用范围：主页，番剧，剧集**

如题，保存，没设置文件名就会让你设置一下

## 退出程序 `exit`

**用法：**

```cmd
exit
```

**适用范围：主页，番剧，剧集**

保存后退出

别点终端上的叉来退出，用这个指令，带保存的

## 复制 `copy`

**用法：**

```cmd
copy [all] [idx]
```

**适用范围：主页，番剧，剧集**

idx 预选择项目
all 忽略项目状态，全部复制，默认复制所有新项目

复制所选项目所包含的磁力链接
当种子下不下来时可以复制磁力链接下载

## 更新 `update`

**用法：**

```cmd
update [all] [idx]
```

**适用范围：主页，番剧**

默认只更新正在更新的番剧，使用 all 选项无视


## 下载 `download`

**用法：**

```cmd
download [all] [idx]
```

**适用范围：主页，番剧，剧集**

默认只下载新剧集，使用 all 选项无视

## 帮助 `help`

**用法：**

```cmd
help
```

**适用范围：主页，番剧，剧集**

显示所有指令与用法

## 一条龙 `f`

**用法：**

```cmd
f
```

**适用范围：主页，番剧**

熟悉不？更新+下载+保存一条龙！当然还是要自己去bt下载软件去下的

## 替换剧集 `search`

**用法：**

```cmd
search idx
```

**适用范围：番剧**

当你对某一集的资源不满意时，可以使用这个指令换一个资源

当然，也可以添加不存在的剧集，比如现在只更新到第8话，用这个指令更新第9话也行

idx 一看就知道是需要替换的集数了，但这个集数应从1开始算起，不是某个制作组第2季第1话他标了13你也用13，还是应该用1的

搜索完成后会分成两个部分，第一部分是可识别的，直接选就行，第二部分是识别不了的，建议先去添加过滤器，再添加剧集，不然大概率是加不进去的。

## 其他指令

你用 `help` 指令看吧，不水了，其他都是很简单的，没什么需要注意的，也不常用

## 删除项目

不提供这个功能，保存文件是纯文本的 xml 格式文件，特别好认，要删的话，用记事本吧，我累了（要不要再做一个重新读取文件的重载功能？啊，好麻烦，算了）

# 添加RSS源

本程序提供的源已经够用，但若还想添加其他源，可关注和修改以下内容：

- **property:** RssSource.sources  
  字符串形式存储的可解析的 RSS 源的使用方法

- **method:** RssSource.rsslink  
  结合 RSS 使用方法，用关键词列表生成的搜索链接

- **method:** episode.fromrss  
  从 RSS 源的单个 item 导入为单个剧集

- **property:** episode.hash  
  可以是 torrent 的哈希值，也可以是其他值，是比较剧集是否相同的重要属性。

- **method:** episode.download  
  下载剧集。

- **method:** bangumi.updatefromrss  
  从 RSS 源更新番剧

- **property:** bangumiset.html  
  导出为 html 格式

# 展望

就差个GUI了吧？

谁能帮我弄个GUI出来啊啊？

